<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Orario Materie</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root {
    --primary: #1E88E5;
    --bg: #121212;
    --text: #eee;
  }
  body {
    font-family: sans-serif;
    margin: 0;
    padding: 10px;
    background: var(--bg);
    color: var(--text);
  }
  .card {
    padding: 15px;
    border-radius: 12px;
    margin: 8px 0;
    box-shadow: 0 3px 6px rgba(0,0,0,0.5);
    background: var(--primary);
    color: white;
  }
  .title { font-size: 16px; font-weight: bold; margin-bottom: 5px; }
  .subject { font-size: 20px; font-weight: bold; }
  #countdown { font-size: 14px; margin-top: 5px; opacity: 0.9; }
  ul { padding-left: 20px; margin: 0; }
  li { margin-bottom: 5px; font-size: 16px; }
  select, button {
    padding: 8px;
    border-radius: 8px;
    border: none;
    margin: 5px 0;
    font-size: 16px;
  }
  select {
    width: 100%;
    background: #333;
    color: #eee;
  }
  .controls { display: flex; gap: 5px; flex-wrap: wrap; margin-bottom: 10px; }
  .controls button {
    flex: 1;
    cursor: pointer;
  }
</style>
</head>
<body>

<div class="controls">
  <select id="daySelect">
    <option value="">Oggi</option>
    <option value="Monday">Luned√¨</option>
    <option value="Tuesday">Marted√¨</option>
    <option value="Wednesday">Mercoled√¨</option>
    <option value="Thursday">Gioved√¨</option>
    <option value="Friday">Venerd√¨</option>
    <option value="Saturday">Sabato</option>
  </select>
  <button onclick="toggleAbbr()">Toggle Abbreviazioni</button>
  <button onclick="toggleTheme()">Dark/Light</button>
  <button onclick="changeColor()">Cambia Colore</button>
</div>

<div class="card now">
  <div class="title">Materia attuale:</div>
  <div class="subject" id="nowSubject">-</div>
  <div id="countdown"></div>
</div>

<div class="card next">
  <div class="title">Prossima materia:</div>
  <div class="subject" id="nextSubject">-</div>
</div>

<div class="card remaining">
  <div class="title">Materie:</div>
  <ul id="remainingSubjects"></ul>
</div>

<div class="card history">
  <div class="title">Storico di oggi:</div>
  <ul id="historySubjects"></ul>
</div>

<script>
const schedule = {
  Monday:['S.T.A. INF','RELIGIONE','INGLESE','CHIMICA','FISICA'],
  Tuesday:['S.T.A. INF','STORIA','CHIMICA','LAB. TTRG','MATEMATICA','INGLESE'],
  Wednesday:['GRAMMATICA','MATEMATICA','MATEMATICA','SC. MOT. SPORT','SC. MOT. SPORT'],
  Thursday:['DIRITTO - EC.','LAB. FISICA','BIOLOGIA','T.T.R.G.','ANTOLOGIA','ANTOLOGIA'],
  Friday:['GRAMMATICA','LAB. CHIMICA','FISICA','BIOLOGIA','MATEMATICA'],
  Saturday:['T.T.R.G.','S.T.A. INF','INGLESE','DIRITTO - EC.','STORIA']
};
const times = {
  Monday:['08:05','09:05','10:05','11:05','12:05'],
  Tuesday:['08:05','09:05','10:05','11:05','12:05','13:05'],
  Wednesday:['08:05','09:05','10:05','11:05','12:05'],
  Thursday:['08:05','09:05','10:05','11:05','12:05','13:05'],
  Friday:['08:05','09:05','10:05','11:05','12:05'],
  Saturday:['08:05','09:05','10:05','11:05','12:05']
};

// giorni festivi manuali (da aggiornare pi√π tardi)
const giorniFestivi = [];

let abbreviazioni = false;
const abbrevMap = {
  'MATEMATICA':'MAT',
  'INGLESE':'ING',
  'GRAMMATICA':'GRAM',
  'CHIMICA':'CHIM',
  'FISICA':'FIS',
  'BIOLOGIA':'BIO',
  'SC. MOT. SPORT':'MOT',
  'RELIGIONE':'REL',
  'DIRITTO - EC.':'DIR',
  'LAB. TTRG':'LAB TTRG',
  'T.T.R.G.':'TTRG',
  'LAB. FISICA':'LAB FIS',
  'LAB. CHIMICA':'LAB CHIM',
  'ANTOLOGIA':'ANTO',
  'S.T.A. INF':'STA INF'
};

function formatSubject(sub){
  if(!abbreviazioni) return sub;
  return abbrevMap[sub] || sub;
}

function toggleAbbr(){
  abbreviazioni = !abbreviazioni;
  updateSchedule(document.getElementById('daySelect').value || null);
}

function toggleTheme(){
  if(document.body.style.background === 'white'){
    document.body.style.background = '#121212';
    document.body.style.color = '#eee';
  } else {
    document.body.style.background = 'white';
    document.body.style.color = 'black';
  }
}

function changeColor(){
  const colors = ['#1E88E5','#43A047','#FF9800','#9C27B0','#E91E63'];
  const current = getComputedStyle(document.documentElement).getPropertyValue('--primary').trim();
  let idx = colors.indexOf(current);
  idx = (idx+1) % colors.length;
  document.documentElement.style.setProperty('--primary', colors[idx]);
}

function updateSchedule(dayOverride=null){
  const now = new Date();
  const weekdays = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  let day = dayOverride || weekdays[now.getDay()];
  let dayIndex = now.getDay();

  // festivo o domenica
  const oggi = now.toISOString().split('T')[0];
  if(day==='Sunday' || giorniFestivi.includes(oggi)){
    document.getElementById('nowSubject').innerText = 'SpongeBob oggi non lavora üßΩ';
    document.getElementById('nextSubject').innerText = '--';
    document.getElementById('remainingSubjects').innerHTML = '';
    document.getElementById('historySubjects').innerHTML = '';
    document.getElementById('countdown').innerText = '';
    return;
  }

  const todaySchedule = schedule[day];
  const todayTimes = times[day];

  let nowSub='nessuna materia ora';
  let nextSub='fine lezioni';
  let remaining=[];
  let history=[];
  let currentIndex=-1;
  let endTime=null;

  if(!dayOverride){
    for(let i=0;i<todaySchedule.length;i++){
      const [h,m] = todayTimes[i].split(':');
      const classTime=new Date();
      classTime.setHours(h,m,0,0);
      const classEnd=new Date(classTime);
      classEnd.setHours(classTime.getHours()+1);

      if(now>=classTime && now<classEnd){
        nowSub=todaySchedule[i];
        currentIndex=i;
        endTime=classEnd;
        break;
      }
    }

    if(currentIndex>=0){
      if(currentIndex+1<todaySchedule.length){
        nextSub=todaySchedule[currentIndex+1];
        remaining=todaySchedule.slice(currentIndex+2);
      } else {
        nextSub='fine lezioni';
        remaining=[];
      }
      history=todaySchedule.slice(0,currentIndex);
    } else {
      let nextDayIndex=(dayIndex%6)+1;
      if(nextDayIndex>6) nextDayIndex=1;
      let nextDay=weekdays[nextDayIndex];
      nowSub='nessuna materia ora';
      nextSub=schedule[nextDay][0];
      remaining=schedule[nextDay].slice(1);
      history=[];
    }
  } else {
    nowSub='-';
    nextSub='--';
    remaining=todaySchedule;
    history=[];
  }

  document.getElementById('nowSubject').innerText=formatSubject(nowSub);
  document.getElementById('nextSubject').innerText=formatSubject(nextSub);

  const remList=document.getElementById('remainingSubjects');
  remList.innerHTML='';
  remaining.forEach(sub=>{
    const li=document.createElement('li');
    li.innerText=formatSubject(sub);
    remList.appendChild(li);
  });

  const histList=document.getElementById('historySubjects');
  histList.innerHTML='';
  history.forEach(sub=>{
    const li=document.createElement('li');
    li.innerText=formatSubject(sub);
    histList.appendChild(li);
  });

  // countdown
  const cd=document.getElementById('countdown');
  if(endTime){
    const diff=Math.floor((endTime-now)/1000);
    if(diff>0){
      const min=Math.floor(diff/60);
      const sec=diff%60;
      cd.innerText=`Finisce tra ${min}m ${sec}s`;
    } else {
      cd.innerText='';
    }
  } else {
    cd.innerText='';
  }
}

document.getElementById('daySelect').addEventListener('change',(e)=>{
  const val=e.target.value;
  if(val) updateSchedule(val);
  else updateSchedule();
});

setInterval(()=>{
  if(!document.getElementById('daySelect').value) updateSchedule();
},1000);

updateSchedule();
</script>
</body>
</html>
