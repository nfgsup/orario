<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Orario Materie</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
@import url('https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap');
body { font-family: 'Roboto', sans-serif; margin:0; padding:10px; background:#121212; color:#eee; display:flex; flex-direction:column; min-height:100vh; }
.card { padding:18px; border-radius:14px; margin:10px 0; box-shadow:0 4px 8px rgba(0,0,0,0.5); background:#1e1e1e; }
.title { font-size:16px; font-weight:700; margin-bottom:5px; }
.subject { font-size:20px; font-weight:700; word-wrap:break-word; }
.now { background:#1E88E5; color:white; }
.next { background:#43A047; color:white; }
.remaining { background:#FF9800; color:white; }
.warning { background:#D32F2F; color:white; }
ul { padding-left:20px; margin:0; }
li { margin-bottom:5px; font-size:16px; }
select,input[type="date"],input[type="text"] { width:100%; padding:10px; border-radius:10px; border:none; background:#333; color:#eee; margin-bottom:15px; font-size:16px; box-sizing:border-box; }
#footer { margin-top:auto; text-align:center; padding:15px 0; font-size:16px; color:#aaa; background:#1a1a1a; border-top:1px solid #333; }
#addWarningArea { margin-top:20px; padding:18px; border-radius:14px; background:#1e1e1e; }
#addWarningArea div { display:flex; gap:10px; margin-bottom:15px; }
#addWarningArea input[type="date"], #addWarningArea input[type="text"] { margin-bottom:0; }
#addWarningButton { background:#3f51b5; color:white; padding:10px 15px; border:none; border-radius:10px; cursor:pointer; font-weight:700; width:100%; font-size:16px; }
#addWarningButton:active { background:#303f9f; }
@media (max-width:480px){ .subject{font-size:18px;} li{font-size:14px;} .title{font-size:14px;} #footer{font-size:14px;} #addWarningArea div{flex-direction:column;} }
</style>
</head>
<body>

<select id="daySelect">
  <option value="">Oggi</option>
  <option value="Monday">Lunedì</option>
  <option value="Tuesday">Martedì</option>
  <option value="Wednesday">Mercoledì</option>
  <option value="Thursday">Giovedì</option>
  <option value="Friday">Venerdì</option>
  <option value="Saturday">Sabato</option>
</select>

<div class="card now">
  <div class="title">Materia attuale:</div>
  <div class="subject" id="nowSubject">-</div>
  <div id="countdown"></div>
</div>

<div class="card next">
  <div class="title">Prossima materia:</div>
  <div class="subject" id="nextSubject">-</div>
</div>

<div class="card remaining">
  <div class="title">Materie:</div>
  <ul id="remainingSubjects"></ul>
</div>

<div class="card warning">
  <div class="title">Avvertimenti:</div>
  <div id="warningsList">-</div>
</div>

<div id="addWarningArea">
  <div class="title">Gestione Avvertimenti</div>
  <div>
    <input type="date" id="warningDate" placeholder="Data Avvertimento">
    <input type="text" id="warningText" placeholder="Descrizione Avvertimento">
  </div>
  <button id="addWarningButton">Aggiungi AVV</button>
</div>

<div id="footer"><span id="dateTime"></span></div>

<script>
const schedule = {
  Monday:['S.T.A. INF','Religione','Inglese','Chimica','Fisica'],
  Tuesday:['S.T.A. INF','Storia','Chimica','Lab. TTRG','Matematica','Inglese'],
  Wednesday:['Grammatica','Matematica','Matematica','Sc. Mot. Sport','Sc. Mot. Sport'],
  Thursday:['Diritto - Ec.','Lab. Fisica','Biologia','T.T.R.G.','Antologia','Antologia'],
  Friday:['Grammatica','Lab. Chimica','Fisica','Biologia','Matematica'],
  Saturday:['T.T.R.G.','S.T.A. INF','Inglese','Diritto - Ec.','Storia']
};
const times = {
  Monday:['08:05','09:05','10:05','11:05','12:05'],
  Tuesday:['08:05','09:05','10:05','11:05','12:05','13:05'],
  Wednesday:['08:05','09:05','10:05','11:05','12:05'],
  Thursday:['08:05','09:05','10:05','11:05','12:05','13:05'],
  Friday:['08:05','09:05','10:05','11:05','12:05'],
  Saturday:['08:05','09:05','10:05','11:05','12:05']
};
const endOfDay = { Monday: '13:05', Tuesday: '14:05', Wednesday: '13:05', Thursday: '14:05', Friday: '13:05', Saturday: '13:05' };

let warnings = [];

async function fetchWarnings(){
  try{
    const res = await fetch('https://TUO_SERVER_URL/get-warnings'); // opzionale, se vuoi endpoint GET
    if(res.ok){ warnings = await res.json(); displayWarnings(); }
  }catch(e){ console.error(e); }
}

function displayWarnings(){
  const list = document.getElementById('warningsList');
  if(warnings.length===0){ list.innerText='-'; return; }
  list.innerText = warnings.map(w=>`${w.date}: ${w.text}`).join('\n');
}

function updateSchedule(dayOverride=null){
  const now = new Date();
  const weekdays = ['Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday'];
  let day = dayOverride || weekdays[now.getDay()];
  let showSchedule = schedule[day] || [];
  let showTimes = times[day] || [];
  let ora = now.getHours(), min = now.getMinutes();
  let nowSub='nessuna materia ora', nextSub='--', remaining=showSchedule.slice(), endTime=null, inClass=false;

  if(showSchedule.length>0){
    for(let i=0;i<showSchedule.length;i++){
      const [h,m]=showTimes[i].split(':');
      const classStart=new Date(); classStart.setHours(h,m,0,0);
      const classEnd=new Date();
      if(i===showSchedule.length-1){ const [eh,em]=endOfDay[day].split(':'); classEnd.setHours(eh,em,0,0); }
      else{ const [nh,nm]=showTimes[i+1].split(':'); classEnd.setHours(nh,nm,0,0); }

      if(now>=classStart && now<classEnd){
        nowSub=showSchedule[i]; endTime=classEnd; inClass=true;
        nextSub=i+1<showSchedule.length?showSchedule[i+1]:'--';
        remaining=showSchedule.slice(i+1);
        break;
      }
    }
  }

  document.getElementById('nowSubject').innerText=nowSub;
  document.getElementById('nextSubject').innerText=nextSub;
  const remList=document.getElementById('remainingSubjects'); remList.innerHTML=''; remaining.forEach(s=>{ const li=document.createElement('li'); li.innerText=s; remList.appendChild(li); });
  const cd=document.getElementById('countdown');
  if(endTime && inClass){
    const diffSec=Math.floor((endTime-now)/1000); const m=Math.floor(diffSec/60); const s=diffSec%60;
    cd.innerText=diffSec>0?`Finisce tra ${m}m ${s}s`:'';
  }else cd.innerText='';
  displayWarnings();
}

function updateDateTime(){ const now=new Date(); const options={weekday:'long',day:'2-digit',month:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'}; document.getElementById('dateTime').innerText=now.toLocaleDateString('it-IT',options); }

async function addWarning(){
  const date=document.getElementById('warningDate').value;
  const text=document.getElementById('warningText').value.trim();
  if(!date||!text){alert('Inserisci data e descrizione'); return;}
  try{
    const res=await fetch('https://orario-psi.vercel.app/api/add-warning',{
      method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({date,text})
    });
    if(res.ok){ alert('Avvertimento aggiunto!'); document.getElementById('warningDate').value=''; document.getElementById('warningText').value=''; updateSchedule(); }
    else{ const err=await res.json(); console.error(err); alert('Errore aggiungendo avvertimento'); }
  }catch(e){ console.error(e); alert('Errore di connessione al server'); }
}

document.getElementById('addWarningButton').addEventListener('click',addWarning);
document.getElementById('daySelect').addEventListener('change', e=>updateSchedule(e.target.value||null));

setInterval(()=>{ updateSchedule(); updateDateTime(); },1000);
updateSchedule(); updateDateTime();
</script>

</body>
</html>

